CREATE TABLE IF NOT EXISTS USERS (
  ID int NOT NULL AUTO_INCREMENT,
  USER_ID varchar(45) NOT NULL,
  USER_PW varchar(100) NOT NULL,
  USER_NAME varchar(45) NOT NULL,
  USER_EMAIL varchar(45) NOT NULL,
  ENABLED tinyint NOT NULL DEFAULT '1',
  REG_DATE timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  MOD_DATE timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (ID),
  UNIQUE KEY USERID_UNIQUE (USER_ID),
  KEY FK_USERID (USER_ID)
);

CREATE TABLE IF NOT EXISTS AUTHORITIES (
  USER_ID varchar(45) NOT NULL,
  AUTHORITY varchar(45) NOT NULL DEFAULT 'USER',
  PRIMARY KEY (USER_ID)
);

CREATE TABLE IF NOT EXISTS STUDY_GROUPS (
  group_id int NOT NULL AUTO_INCREMENT,
  group_category varchar(45) NOT NULL,
  group_name varchar(45) NOT NULL,
  group_detail longtext NOT NULL,
  group_member_limit int NOT NULL,
  group_period varchar(45) DEFAULT NULL,
  group_area varchar(45) NOT NULL,
  group_start_age int DEFAULT NULL,
  group_end_age int DEFAULT NULL,
  reg_date timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  mod_date timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (group_id),
  UNIQUE KEY group_id_UNIQUE (group_id),
  UNIQUE KEY group_name_UNIQUE (group_name)
);

CREATE TABLE IF NOT EXISTS group_members (
  group_id int NOT NULL AUTO_INCREMENT,
  user_id varchar(45) NOT NULL,
  group_authority varchar(45) NOT NULL DEFAULT 'USER',
  demerit_cnt int unsigned NOT NULL DEFAULT '0',
  reg_date timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  mod_date timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (group_id),
  UNIQUE KEY group_id_UNIQUE (group_id)
);

ALTER TABLE AUTHORITIES ADD CONSTRAINT FK_USERID FOREIGN KEY (USER_ID) REFERENCES USERS (USER_ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE GROUP_MEMBERS ADD CONSTRAINT FK_GROUPID FOREIGN KEY (GROUP_ID) REFERENCES STUDY_GROUPS (GROUP_ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE GROUP_MEMBERS ADD CONSTRAINT FK_GROUP_USERID FOREIGN KEY(USER_ID) REFERENCES USERS (USER_ID) ON DELETE CASCADE ON UPDATE CASCADE;